{% extends "base.html" %}
{% block content %}
<div class="slideshow-container">
  <h2>{{ department | upper }} Slideshow</h2>
  <div class="slideshow" id="slideshow">
    {% for notice in notices %}
      <div class="slide" style="display: none;">
        {% set file_url = url_for('uploaded_file', filename=notice[2]) %}
        {% if notice[3] in ['png', 'jpg', 'jpeg', 'gif', 'pdf_image'] %}
          <img src="{{ file_url }}" alt="Notice Image">
        {% elif notice[3] == 'mp4' %}
          <video src="{{ file_url }}" autoplay muted playsinline></video>
        {% elif notice[3] == 'mp3' %}
          <audio src="{{ file_url }}" autoplay controls></audio>
        {% else %}
          <a href="{{ file_url }}" target="_blank" download>View Document</a>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  <button id="restartSlideshow" class="btn btn-secondary" style="margin-top: 20px;">Restart Slideshow</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const slides = document.querySelectorAll('.slideshow .slide');
  let currentIndex = 0;
  let timeoutHandle;

  function showSlide(index) {
    clearTimeout(timeoutHandle);
    // Hide all slides
    slides.forEach(slide => slide.style.display = 'none');
    let currentSlide = slides[index];
    currentSlide.style.display = 'block';

    // Check if the slide contains a video element
    let video = currentSlide.querySelector('video');
    if (video) {
      // Restart the video playback
      video.currentTime = 0;
      // When the video ends, move to the next slide
      video.onended = function() {
        nextSlide();
      };
    } else {
      // For non-video slides, wait 5 seconds then go to next slide
      timeoutHandle = setTimeout(nextSlide, 5000);
    }
  }

  function nextSlide() {
    currentIndex = (currentIndex + 1) % slides.length;
    showSlide(currentIndex);
  }

  function startSlideshow() {
    currentIndex = 0;
    showSlide(currentIndex);
  }

  startSlideshow();

  document.getElementById('restartSlideshow').addEventListener('click', function() {
    startSlideshow();
  });
});
</script>
{% endblock %}
